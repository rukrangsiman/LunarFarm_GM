
<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Growth Monitoring ‚Äî Lunar Farming</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Favicon: quick prototype using existing image files (replace with favicon.ico or 32x32 png for production) -->
  <link rel="icon" href="image/L.png" type="image/png">
  <link rel="shortcut icon" href="image/L.png">
  <link rel="apple-touch-icon" href="image/L.png">
    <style>
      @keyframes spin { 100% { transform: rotate(360deg); } }
      :root{
        --bg:#0f172a;        /* slate-900 */
        --panel:#111827;     /* gray-900 */
        --muted:#94a3b8;     /* slate-400 */
        --ink:#e5e7eb;       /* gray-200 */
        --accent:#22c55e;    /* green-500 */
        --accent-2:#60a5fa;  /* blue-400 */
        --accent-3:#a21caf;  /* purple-700 */
        --danger:#ef4444;    /* red-500 */
        --warn:#f59e0b;      /* amber-500 */
        --shadow:0 4px 32px 0 rgba(34,197,94,0.10), 0 1.5px 8px 0 rgba(96,165,250,0.10);
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        background:
          linear-gradient(rgba(17, 24, 39, 0.226), rgba(17,24,39,0.82)),
          url('image/bg.jpg') center center / cover no-repeat fixed;
        background-attachment: fixed;
        color:var(--ink);
        font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      }
  .app{max-width:1100px;margin:32px auto;padding:28px 24px 24px 24px; background:rgba(17,24,39,0.85); border-radius:24px; box-shadow:var(--shadow);}
      .nav{
        display:flex;gap:12px;flex-wrap:wrap;margin:16px 0 24px 0; justify-content:flex-start;
      }
      .btn{
        padding:12px 22px;
        border:none;
        border-radius:14px;
        background:#1e293b;
        color:var(--ink);
        cursor:pointer;
        transition:all .15s cubic-bezier(.4,0,.2,1);
        font-weight:600;
        font-size:16px;
        box-shadow:0 1.5px 6px 0 rgba(34,197,94,0.07);
        display:flex; align-items:center; gap:8px;
      }
      .btn:hover{
        background:#334155;
        color:var(--accent);
        transform:translateY(-1.5px) scale(1.02);
      }
      .btn.accent{
        background:var(--accent);
        color:#fff;
        border:none;
        box-shadow:0 2px 12px 0 rgba(34,197,94,0.13);
      }
      .btn.accent:hover{
        background:var(--accent-2);
        color:#fff;
      }
      .grid{display:grid; gap:18px}
      .grid.kpi{grid-template-columns: repeat(4, minmax(0,1fr)); margin-bottom:18px;}
      .card{
        background:linear-gradient(120deg, rgba(69, 179, 118, 0.2) 0%, rgba(96,165,250,.10) 100%);
        border:1.5px solid rgba(148,163,184,.18);
        padding:22px 18px;
        border-radius:20px;
        box-shadow:0 2px 16px 0 rgba(96,165,250,0.08);
        position:relative;
        overflow:hidden;
      }
  .title{font-weight:800; font-size:28px; margin:6px 0 18px; letter-spacing:-1px; text-shadow:0 2px 8px rgba(34,197,94,0.10);}
  .sub{color:var(--muted); font-size:14px; margin-bottom:8px;}
  .kpi{font-size:34px; font-weight:800; text-shadow:0 2px 8px rgba(96,165,250,0.10);}
  .tag{display:inline-flex; align-items:center; gap:6px; font-size:13px; padding:5px 12px; border-radius:999px; border:1.5px solid rgba(148,163,184,.35); color:var(--ink); background:rgba(255,255,255,0.04); font-weight:600; box-shadow:0 1px 4px 0 rgba(34,197,94,0.07);}
  .tag.warn{border-color:var(--warn); color:#fde68a; background:rgba(245,158,11,0.08);}
  .tag.danger{border-color:var(--danger); color:#fecaca; background:rgba(239,68,68,0.08);}
  .list{display:flex; flex-direction:column; gap:14px}
  .row{display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border:1.5px dashed rgba(148,163,184,.13); border-radius:16px; background:rgba(17,24,39,0.7); box-shadow:0 1px 6px 0 rgba(96,165,250,0.07);}
  .muted{color:var(--muted); font-size:13px;}
      .field{display:flex; flex-direction:column; gap:8px; margin-bottom:16px}
      input, select{
        background:rgba(11,18,32,0.95); color:var(--ink); border:1.5px solid #1f2937; border-radius:14px; padding:12px 14px; font-size:15px; box-shadow:0 1px 4px 0 rgba(96,165,250,0.07);
      }
  .login{max-width:420px;margin:180px auto 40px; box-shadow:0 4px 32px 0 rgba(96,165,250,0.13);}
  .footer{margin-top:18px; color:var(--muted); font-size:12px; text-align:center;}
  .flex{display:flex;gap:10px; align-items:center}
  .chart{height:160px; width:100%; background:linear-gradient(120deg, rgba(34,197,94,.13), rgba(96,165,250,.13)); border-radius:16px; position:relative; overflow:hidden; border:1.5px solid rgba(148,163,184,.18); box-shadow:0 1px 8px 0 rgba(34,197,94,0.07);}
  .dot{position:absolute; width:12px; height:12px; background:linear-gradient(135deg, var(--accent-2), var(--accent)); border-radius:50%; transform:translate(-50%,-50%); opacity:.92; box-shadow:0 2px 8px 0 rgba(96,165,250,0.13); border:2.5px solid #fff2;}
  .legend{display:flex; gap:10px; font-size:13px; color:var(--muted); margin-top:10px;}
  .pill{padding:5px 12px; background:rgba(11,18,32,0.92); border:1.5px solid rgba(148,163,184,.18); border-radius:999px; font-size:13px; font-weight:600; color:var(--accent-2);}
  .cols{display:grid; grid-template-columns: 1.2fr .8fr; gap:18px}
      @media (max-width: 900px){ .grid.kpi{grid-template-columns:1fr 1fr} .cols{grid-template-columns:1fr} }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script>
  const { useState, useMemo, useEffect } = React;

      // -------- Mock Data --------
      let batches = [
        { id:'A-01', species:'Lettuce', stage:'mature',  start:'2025-08-20', images: 9, img: 'image/lettuce.jpg', timelapse: ['Timelapse/Lettuce/L1.png','Timelapse/Lettuce/L2.png','Timelapse/Lettuce/L3.png','Timelapse/Lettuce/L4.png','Timelapse/Lettuce/L5.png','Timelapse/Lettuce/L6.png','Timelapse/Lettuce/L7.png','Timelapse/Lettuce/L8.png','Timelapse/Lettuce/L9.png'] },
        { id:'B-07', species:'Spinach', stage:'seedling', start:'2025-08-27', images: 6, img: 'image/Spinach.jpg', timelapse: ['Timelapse/Spinach/S1.png','Timelapse/Spinach/S2.png','Timelapse/Spinach/S3.png','Timelapse/Spinach/S4.png','Timelapse/Spinach/S5.png','Timelapse/Spinach/S6.png'] },
        { id:'C-03', species:'Kale',    stage:'growing',  start:'2025-08-22', images: 7, img: 'image/Kale.jpg', timelapse: ['Timelapse/Kale/K1.png','Timelapse/Kale/K2.png','Timelapse/Kale/K3.png','Timelapse/Kale/K4.png','Timelapse/Kale/K5.png','Timelapse/Kale/K6.png','Timelapse/Kale/K7.png'] }
      ];

      let metrics = {
        'A-01': {
          height:[12,15,18,22,25,27,29],
          temp:[22,22,23,24,22,21,22],
          ph:[6.1,6.5,5.7,6.3,5.8,6.4,6.0]
        },
        'B-07': {
          height:[3,5,7,8,10,12,14],
          temp:[23,23,22,22,22,21,22],
          ph:[5.8,6.3,5.6,6.1,5.7,6.2,5.9]
        },
        'C-03': {
          height:[6,7,8,10,11,13,14],
          temp:[21,21,22,22,21,22,22],
          ph:[6.2,5.9,6.4,6.0,6.5,5.8,6.3]
        },
      };

      let alerts = [
        { id:1, batch:'A-01', ts:'2025-09-01 10:12', type:'High', metric:'EC', msg:'EC ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î 2.1 mS/cm', action:'‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡∏™‡∏≤‡∏£‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢' },
        { id:2, batch:'B-07', ts:'2025-09-02 08:15', type:'Low', metric:'Temp', msg:'‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥ 17¬∞C', action:'‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô +1¬∞C' },
        { id:3, batch:'C-03', ts:'2025-09-03 14:20', type:'Trend', metric:'pH', msg:'pH ‡∏•‡∏î‡∏•‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á 6.2‚Üí6.0', action:'‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏≤‡∏£‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà' },
      ];

      // -------- Mission Accounts --------
      const missionAccounts = [
        { username: 'astronaut01', password: 'lunar2025', role: 'Astronaut' },
        { username: 'scientist01', password: 'research2025', role: 'Scientist' },
        { username: 'commander01', password: 'mission2025', role: 'Commander' }
      ];

      // -------- Small helpers --------
      function Tag({children, tone}){
        const cls = 'tag ' + (tone || '');
        return React.createElement('span',{className:cls}, children);
      }

function KPI({label, value, unit}){
  return React.createElement('div',{className:'card'},
    React.createElement('div',{className:'sub'}, label),
    React.createElement('div',{className:'kpi'}, value + (unit||''))
  );
}

// ModernChart: ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏° grid ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á, ‡∏à‡∏∏‡∏î, tooltip, ‡πÅ‡∏•‡∏∞ y-axis ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 0
function ModernChart({series, color='#60a5fa'}) {
        const [hoverIdx, setHoverIdx] = useState(null);
        const min = 0;
        const max = Math.max(...series);
        const N = series.length;
        const marginY = 10, marginX = 38;
        const chartW = 520, chartH = 120;
        // scale
        const getX = i => marginX + i * (chartW-2*marginX)/(N-1);
        const getY = v => marginY + (1-((v-min)/((max-min)||1))) * (chartH-2*marginY);
        // line path (Bezier)
        let d = '';
        for(let i=0;i<N;i++){
          const x = getX(i), y = getY(series[i]);
          if(i===0) d += `M${x},${y}`;
          else {
            const prevX = getX(i-1), prevY = getY(series[i-1]);
            const c1x = prevX + (x-prevX)/2, c1y = prevY;
            const c2x = prevX + (x-prevX)/2, c2y = y;
            d += ` C${c1x},${c1y} ${c2x},${c2y} ${x},${y}`;
          }
        }
        // area path
        let area = d + ` L${getX(N-1)},${chartH-marginY} L${getX(0)},${chartH-marginY} Z`;
        // grid y = 0 (bottom)
        const y0 = getY(0);
        return React.createElement('div', {
          className:'chart',
          style:{background:'linear-gradient(120deg, rgba(34,197,94,.10), rgba(96,165,250,.13))', borderRadius:'24px', minHeight:'300px', display:'flex',alignItems:'center',justifyContent:'center'}
        },
          React.createElement('svg', {
            width:chartW, height:chartH, viewBox:`0 0 ${chartW} ${chartH}`,
            style:{width:'100%',height:'100%'}
          },
            // thin grid line at bottom (y=0)
            React.createElement('line',{
              x1:marginX, x2:chartW-marginX,
              y1:y0, y2:y0,
              stroke:'#b6c2d6', strokeDasharray:'2 2', strokeWidth:0.7, opacity:0.18
            }),
            // vertical grid lines for each point
            series.map((v,i)=>React.createElement('line',{
              key:'vgrid'+i,
              x1:getX(i), x2:getX(i),
              y1:y0, y2:y0+8,
              stroke:'#b6c2d6', strokeWidth:0.7, opacity:0.22
            })),
            // x-axis labels (index or custom label)
            series.map((v,i)=>React.createElement('text',{
              key:'xlabel'+i,
              x:getX(i), y:y0+22,
              textAnchor:'middle', fontSize:'13', fill:'#b6c2d6', fontWeight:500
            },i+1)),
            // y-axis label (always 0 at bottom)
            React.createElement('text',{
              x:marginX-10, y:y0+5,
              textAnchor:'end', fontSize:'13', fill:'#b6c2d6', fontWeight:600
            },0),
            // area fill
            React.createElement('path',{
              d:area,
              fill:color,
              opacity:0.10
            }),
            // line
            React.createElement('path',{
              d,
              fill:'none',
              stroke:color,
              strokeWidth:3.2,
              style:{filter:'drop-shadow(0 2px 8px '+color+'44)'}
            }),
            // dots and value labels
            series.map((v,i)=>React.createElement(React.Fragment, {key:'dotfrag'+i},
              React.createElement('circle',{
                cx:getX(i),
                cy:getY(v),
                r: hoverIdx===i?6:4.2,
                fill:'#fff',
                stroke:color,
                strokeWidth:2.2,
                style:{cursor:'pointer',filter:hoverIdx===i?'drop-shadow(0 2px 8px '+color+'66)':'none'},
                onMouseEnter:()=>setHoverIdx(i),
                onMouseLeave:()=>setHoverIdx(null)
              }),
              React.createElement('text',{
                x:getX(i), y:getY(v)-12,
                textAnchor:'middle', fontSize:'13', fill:'#fff', fontWeight:700,
                style:{textShadow:'0 1px 6px #0008'}
              },v)
            )),
            // value labels (tooltip style)
            hoverIdx!==null && React.createElement('g',null,
              React.createElement('rect',{
                x:getX(hoverIdx)-18, y:getY(series[hoverIdx])-32,
                width:36, height:22, rx:7,
                fill:'#1e293b', stroke:color, strokeWidth:1.2, opacity:0.97
              }),
              React.createElement('text',{
                x:getX(hoverIdx), y:getY(series[hoverIdx])-18,
                textAnchor:'middle', fontSize:'13', fill:'#fff', fontWeight:700
              },series[hoverIdx])
            )
          )
        );
      }

      // -------- Screens --------
      function Login({onLogin}){
        const [u,setU] = useState('');
        const [p,setP] = useState('');
        const [r,setR] = useState('Astronaut');
        const [error, setError] = useState('');
        const handleLogin = () => {
          setError('');
          const account = missionAccounts.find(acc => acc.username === u && acc.password === p);
          if(!account) {
            setError('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            return;
          }
          onLogin({name: u, role: account.role, password: p});
        };
        return React.createElement('div',{className:'login card'},
          React.createElement('div',{className:'title'},'User Login'),
          error && React.createElement('div',{style:{padding:'12px 14px', borderRadius:'12px', background:'rgba(239,68,68,0.15)', border:'1.5px solid #ef4444', color:'#fecaca', marginBottom:'16px', fontSize:'14px', fontWeight:'600'}}, error),
          React.createElement('div',{className:'field'},
            React.createElement('label',null,'Username'),
            React.createElement('input',{
              placeholder:'‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',
              value:u,
              autoComplete:'username',
              onChange:e=>{setU(e.target.value); setError('');}
            })
          ),
          React.createElement('div',{className:'field'},
            React.createElement('label',null,'Password'),
            React.createElement('input',{
              type:'password',
              placeholder:'‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô',
              value:p,
              autoComplete:'current-password',
              onChange:e=>{setP(e.target.value); setError('');}
            })
          ),
          React.createElement('div',{className:'field'},
            React.createElement('label',null,'Role Selection'),
            React.createElement('select',{value:r,onChange:e=>setR(e.target.value)},
              React.createElement('option',null,'Astronaut'),
              React.createElement('option',null,'Scientist'),
              React.createElement('option',null,'Commander')
            )
          ),
          React.createElement('button',{
            className:'btn accent',
            onClick:handleLogin
          },'‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'),
          React.createElement('div',{className:'footer', style:{marginTop:'16px', fontSize:'12px', color:'var(--muted)', textAlign:'center'}},
            React.createElement('div',null, '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:'),
            React.createElement('div',null, 'astronaut01 / lunar2025'),
            React.createElement('div',null, 'scientist01 / research2025'),
            React.createElement('div',null, 'commander01 / mission2025')
          )
        )
      }


  function Dashboard({go, selected, setSelected, onLogout}){
        const kpis = useMemo(()=>{
          return {
            germination: '96%',
            growth: '2.1 cm/day',
            survival: '93%',
            resource: 'Water 1.2 L/kg'
          }
        },[]);
        const [search, setSearch] = useState('');
        const [stageFilter, setStageFilter] = useState('all');
        const stages = ['all', 'seedling', 'growing', 'mature'];
        const stageLabels = {all: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', seedling: '‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤', growing: '‡πÇ‡∏ï‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà', mature: '‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß'};
        const filteredBatches = batches.filter(b => 
          (stageFilter === 'all' || b.stage === stageFilter) &&
          (b.id.toLowerCase().includes(search.toLowerCase()) ||
           b.species.toLowerCase().includes(search.toLowerCase()))
        );
        return React.createElement('div',{className:'app'},
          React.createElement('div',{className:'title'},'Lunar Farm Growth Monitoring'),
          React.createElement('div',{className:'nav'},
            React.createElement('button',{className:'btn accent',onClick:()=>go('dashboard')} ,'Dashboard'),
            React.createElement('button',{className:'btn',onClick:()=>go('batches')} ,'Batches'),
            React.createElement('button',{className:'btn',onClick:()=>go('alerts')} ,'Alerts'),
            React.createElement('button',{className:'btn',onClick:()=>go('reports')} ,'Reports'),
            React.createElement('button',{className:'btn',onClick:()=>go('settings')} ,'Settings'),
            React.createElement('button',{
              className:'btn',
              style:{marginLeft:'auto', background:'#ef4444', color:'#fff', fontWeight:700},
              onClick:()=>{ onLogout && onLogout(); }
            },'Logout')
          ),
          React.createElement('div', {style:{margin:'0 0 18px 0', display:'flex', alignItems:'center', gap:'12px', flexWrap:'wrap'}},
            React.createElement('input', {
              type: 'text',
              placeholder: '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Batch ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä...',
              value: search,
              onChange: e => setSearch(e.target.value),
              style: {
                flex:1,
                minWidth:'200px',
                padding:'12px 16px',
                borderRadius:'12px',
                border:'1.5px solid #1f2937',
                background:'#111827',
                color:'var(--ink)',
                fontSize:'16px',
                outline:'none',
                boxShadow:'0 1px 4px 0 rgba(96,165,250,0.07)'
              }
            }),
            React.createElement('select', {
              value: stageFilter,
              onChange: e => setStageFilter(e.target.value),
              style: {
                padding:'12px 14px',
                borderRadius:'12px',
                border:'1.5px solid #1f2937',
                background:'#111827',
                color:'var(--ink)',
                fontSize:'15px',
                fontWeight:'600',
                cursor:'pointer',
                outline:'none',
                boxShadow:'0 1px 4px 0 rgba(96,165,250,0.07)'
              }
            },
              stages.map(s => React.createElement('option', {key:s, value:s}, stageLabels[s]))
            )
          ),
          React.createElement('div',{className:'grid kpi'},
            React.createElement(KPI,{label:'Germination', value:kpis.germination}),
            React.createElement(KPI,{label:'Avg Growth Rate', value:kpis.growth}),
            React.createElement(KPI,{label:'Survival', value:kpis.survival}),
            React.createElement(KPI,{label:'Resource Use', value:kpis.resource})
          ),
          React.createElement('div',{className:'card', style:{marginBottom:'18px'}},
            React.createElement('div',{className:'sub', style:{marginBottom:'8px'}},'‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Batch'),
            React.createElement('div',{className:'list'},
              filteredBatches.length === 0 ?
                React.createElement('div',{className:'muted'},'‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤') :
                filteredBatches.map(b=>React.createElement('div',{key:b.id,className:'row'},
                  React.createElement('div',null,
                    React.createElement('div',null, b.id + ' ‚Ä¢ ' + b.species + ' ‚Ä¢ ' + b.stage),
                    React.createElement('div',{className:'muted'}, '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡∏π‡∏Å: ' + b.start + ' ‚Ä¢ ‡∏£‡∏π‡∏õ: ' + b.images + ' ‡∏†‡∏≤‡∏û')
                  ),
                  React.createElement('button',{className:'btn',onClick:()=>go('detail', b.id)},'‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î')
                ))
            )
          ),
          React.createElement('div',{className:'cols'},
            React.createElement('div',{className:'card'},
              React.createElement('div',{className:'sub'},'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô (cm) ‚Äî 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î'),
              React.createElement(ModernChart,{series: metrics['A-01'].height, color:'#60a5fa'}),
              React.createElement('div',{className:'legend'}, 
                React.createElement('span',{className:'pill'},'Batch A-01'), 
                React.createElement('span',{className:'pill'},'Lettuce')
              )
            ),
            React.createElement('div',{className:'card'},
              React.createElement('div',{className:'sub'},'‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î'),
              React.createElement('div',{className:'list'},
                alerts.slice(0,3).map(a=>React.createElement('div',{key:a.id,className:'row'},
                  React.createElement('div',null, 
                    React.createElement('div',null, a.msg),
                    React.createElement('div',{className:'muted'}, a.ts + ' ‚Ä¢ ' + a.batch)
                  ),
                  React.createElement(Tag,{tone: a.type==='High'?'danger':(a.type==='Low'?'warn':'')}, a.type)
                ))
              )
            )
          )
        )
      }

      function Batches({go}){
        const [stageFilter, setStageFilter] = useState('all');
        const [search, setSearch] = useState('');
        const stages = ['all', 'seedling', 'growing', 'mature'];
        const stageLabels = {all: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', seedling: '‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤', growing: '‡πÇ‡∏ï‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà', mature: '‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß'};
        const filteredBatches = batches.filter(b =>
          (stageFilter === 'all' || b.stage === stageFilter) &&
          (b.id.toLowerCase().includes(search.toLowerCase()) || b.species.toLowerCase().includes(search.toLowerCase()))
        );
        return React.createElement('div',{className:'app'},
          React.createElement('div',{className:'title'},'Batches'),
          React.createElement('div', {style:{margin:'0 0 18px 0', display:'flex', alignItems:'center', gap:'12px', flexWrap:'wrap'}},
            React.createElement('input', {
              type: 'text',
              placeholder: '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Batch ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä...',
              value: search,
              onChange: e => setSearch(e.target.value),
              style: {
                flex:1,
                minWidth:'200px',
                padding:'10px 14px',
                borderRadius:'12px',
                border:'1.5px solid #1f2937',
                background:'#111827',
                color:'var(--ink)',
                fontSize:'15px',
                outline:'none',
                boxShadow:'0 1px 4px 0 rgba(96,165,250,0.07)'
              }
            }),
            React.createElement('label', {style:{fontSize:'14px', fontWeight:'600', color:'var(--muted)'}}, '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï:'),
            React.createElement('select', {
              value: stageFilter,
              onChange: e => setStageFilter(e.target.value),
              style: {
                padding:'10px 14px',
                borderRadius:'12px',
                border:'1.5px solid #1f2937',
                background:'#111827',
                color:'var(--ink)',
                fontSize:'15px',
                fontWeight:'600',
                cursor:'pointer',
                outline:'none',
                boxShadow:'0 1px 4px 0 rgba(96,165,250,0.07)'
              }
            },
              stages.map(s => React.createElement('option', {key:s, value:s}, stageLabels[s]))
            )
          ),
          React.createElement('div',{className:'list'},
            filteredBatches.length === 0 ?
              React.createElement('div',{className:'muted'},'‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•') :
              filteredBatches.map(b=>React.createElement('div',{key:b.id,className:'row'},
              React.createElement('div', {style:{display:'flex',alignItems:'center',gap:'16px'}},
                b.img && React.createElement('img', {
                  src: b.img,
                  alt: b.species,
                  style: {width:'54px',height:'54px',objectFit:'cover',borderRadius:'12px',border:'1.5px solid #334155',background:'#222'}
                }),
                React.createElement('div',null,
                  React.createElement('div',null, b.id + ' ‚Ä¢ ' + b.species + ' ‚Ä¢ ' + b.stage),
                  React.createElement('div',{className:'muted'}, '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡∏π‡∏Å: ' + b.start + ' ‚Ä¢ ‡∏£‡∏π‡∏õ: ' + b.images + ' ‡∏†‡∏≤‡∏û')
                )
              ),
              React.createElement('button',{className:'btn',onClick:()=>go('detail', b.id)},'‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î')
            ))
          ),
          React.createElement('div',{className:'nav'},
            React.createElement('button',{className:'btn',onClick:()=>go('dashboard')},'‡∏Å‡∏•‡∏±‡∏ö Dashboard')
          )
        )
      }

      function BatchDetail({id, go}){
        const m = metrics[id] || {height:[], temp:[], ph:[]};
        const batch = batches.find(x=>x.id===id) || null;
        const [showTimeLapse, setShowTimeLapse] = useState(false);
        const [timelapseIdx, setTimelapseIdx] = useState(0);
        // date-range state (inputs expect YYYY-MM-DD)
        const today = new Date();
        const pad = n => n.toString().padStart(2,'0');
        const fmt = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
        const N = Math.max(m.height.length, m.temp.length, m.ph.length);
        // default: show full series range
        const defaultTo = fmt(today);
        const earliest = new Date(); earliest.setDate(today.getDate() - (N-1));
        const defaultFrom = fmt(earliest);
        const [dateFrom, setDateFrom] = useState(defaultFrom);
        const [dateTo, setDateTo] = useState(defaultTo);

        // build an array of dates that map to metric indices (assume last value = today)
        const baseDates = [];
        for(let i=0;i<N;i++){
          const d = new Date();
          d.setDate(today.getDate() - (N-1 - i));
          baseDates.push(fmt(d));
        }

        // compute which indices fall into selected range
        const fromDateObj = new Date(dateFrom + 'T00:00:00');
        const toDateObj = new Date(dateTo + 'T23:59:59');
        const indices = baseDates.map((ds,i)=>({ds, i})).filter(x=>{
          const dd = new Date(x.ds + 'T12:00:00');
          return dd >= fromDateObj && dd <= toDateObj;
        }).map(x=>x.i);

        // filtered series (preserve order)
        const filteredHeight = indices.map(i=>m.height[i]).filter(v=>typeof v !== 'undefined');
        const filteredPH = indices.map(i=>m.ph[i]).filter(v=>typeof v !== 'undefined');
        const filteredTemp = indices.map(i=>m.temp[i]).filter(v=>typeof v !== 'undefined');

        // KPIs over selected range
        const maxHeight = filteredHeight.length? Math.max(...filteredHeight) : (m.height.length? Math.max(...m.height): 0);
        const lastPH = filteredPH.length? filteredPH[filteredPH.length-1] : (m.ph.length? m.ph[m.ph.length-1] : '-');
        const avgTemp = filteredTemp.length? Math.round(filteredTemp.reduce((a,b)=>a+b,0)/filteredTemp.length) : (m.temp.length? Math.round(m.temp.reduce((a,b)=>a+b,0)/m.temp.length) : '-');

        return React.createElement('div',{className:'app'},
          React.createElement('div',{className:'title'},'Batch Detail ‚Äî ' + id),

          // date range controls
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{style:{display:'flex',gap:12,flexWrap:'wrap',alignItems:'center'}},
              React.createElement('div', {style:{minWidth:180}},
                React.createElement('label',{className:'muted'}, '‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏à‡∏≤‡∏Å)'),
                React.createElement('input', {type:'date', value:dateFrom, onChange:e=>setDateFrom(e.target.value), style:{width:'100%'}})
              ),
              React.createElement('div', {style:{minWidth:180}},
                React.createElement('label',{className:'muted'}, '‡∏ñ‡∏∂‡∏á'),
                React.createElement('input', {type:'date', value:dateTo, onChange:e=>setDateTo(e.target.value), style:{width:'100%'}})
              ),
              React.createElement('div', {style:{display:'flex',gap:8,alignItems:'flex-end'}},
                React.createElement('button',{className:'btn', onClick:()=>{ setDateFrom(defaultFrom); setDateTo(defaultTo); }},'Reset')
              )
            )
          ),

          batch && batch.img && React.createElement('div', {
            style: {display:'flex',justifyContent:'center',alignItems:'center',margin:'0 0 16px 0'}
          },
            React.createElement('img', {
              src: batch.img,
              alt: batch.species,
              style: {width:'380px',height:'260px',objectFit:'cover',borderRadius:'22px',border:'2.5px solid #334155',background:'#222',boxShadow:'0 4px 32px 0 rgba(34,197,94,0.13)'}
            })
          ),

          React.createElement('div',{className:'grid kpi'},
            React.createElement(KPI,{label:'‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (cm)', value: maxHeight}),
            React.createElement(KPI,{label:'pH ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î', value: lastPH}),
            React.createElement(KPI,{label:'‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (¬∞C)', value: avgTemp}),
            React.createElement(KPI,{label:'‡∏£‡∏π‡∏õ Time‚Äëlapse', value: (batch||{images:0}).images })
          ),

          React.createElement('div',{className:'cols'},
            React.createElement('div',{className:'card'},
              React.createElement('div',{className:'sub'},'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô (cm)'),
              React.createElement(ModernChart,{series: filteredHeight.length? filteredHeight : m.height, color:'#60a5fa'})
            ),
            React.createElement('div',{className:'card'},
              React.createElement('div',{className:'sub'},'pH'),
              React.createElement(ModernChart,{series: filteredPH.length? filteredPH : m.ph, color:'#22c55e'})
            )
          ),

          // Time-lapse Gallery Modal
          showTimeLapse && React.createElement('div',{style:{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.85)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:9999}},
            React.createElement('div',{style:{background:'#0f172a',borderRadius:'24px',padding:'24px',maxWidth:'600px',width:'90%',boxShadow:'0 8px 32px rgba(0,0,0,0.5)',display:'flex',flexDirection:'column',gap:16}},
              React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
                React.createElement('div',{style:{fontSize:'20px',fontWeight:'700',color:'var(--ink)'}},'Time-lapse ‚Äî ' + id),
                React.createElement('button',{style:{background:'#ef4444',border:'none',borderRadius:'50%',width:'36px',height:'36px',cursor:'pointer',fontSize:'20px',color:'#fff',fontWeight:'700'},onClick:()=>setShowTimeLapse(false)},'√ó')
              ),
              React.createElement('div',{style:{display:'flex',justifyContent:'center',alignItems:'center',background:'#111827',borderRadius:'16px',padding:'16px',minHeight:'300px'}},
                batch && batch.timelapse && batch.timelapse.length > 0 ? 
                  React.createElement('img',{src:batch.timelapse[timelapseIdx],alt:batch.species,style:{maxWidth:'100%',maxHeight:'280px',borderRadius:'12px'}}) :
                  React.createElement('div',{className:'muted'},'‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ')
              ),
              React.createElement('div',{style:{display:'flex',gap:8,justifyContent:'space-between',alignItems:'center'}},
                React.createElement('button',{className:'btn',onClick:()=>setTimelapseIdx(Math.max(0,timelapseIdx-1)),disabled:timelapseIdx===0},'‚Üê'),
                React.createElement('div',{style:{flex:1,textAlign:'center',color:'var(--muted)',fontSize:'14px'}},'‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà ' + (timelapseIdx+1) + ' ‡∏à‡∏≤‡∏Å ' + (batch?.timelapse?.length||0)),
                React.createElement('button',{className:'btn',onClick:()=>setTimelapseIdx(Math.min((batch?.timelapse?.length||0)-1,timelapseIdx+1)),disabled:timelapseIdx===(batch?.timelapse?.length||0)-1},'‚Üí')
              ),
              React.createElement('button',{className:'btn accent',onClick:()=>setShowTimeLapse(false),style:{width:'100%'}},'‡∏õ‡∏¥‡∏î')
            )
          ),

          React.createElement('div',{className:'nav'},
            React.createElement('button',{className:'btn',onClick:()=>setShowTimeLapse(true),style:{background:'#60a5fa',color:'#fff'}},'üì∑ ‡∏î‡∏π‡∏†‡∏≤‡∏û Time-lapse (' + (batch?.images||0) + ' ‡∏†‡∏≤‡∏û)'),
            React.createElement('button',{className:'btn',onClick:()=>go('batches')},'‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö')
          )
        )
      }

      function Alerts({go}){
        const [levelFilter, setLevelFilter] = React.useState({High: true, Low: true, Trend: true});
        const filteredAlerts = alerts.filter(a => levelFilter[a.type]);
        
        return React.createElement('div',{className:'app'},
          React.createElement('div',{className:'title'},'Alerts'),
          
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{style:{display:'flex',gap:16,flexWrap:'wrap',alignItems:'center'}},
              React.createElement('label',{style:{fontSize:'14px',fontWeight:'600',color:'var(--muted)'}}, '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:'),
              React.createElement('div',{style:{display:'flex',gap:12,alignItems:'center'}},
                React.createElement('label',{style:{display:'flex',alignItems:'center',gap:6,cursor:'pointer'}},
                  React.createElement('input',{
                    type:'checkbox',
                    checked:levelFilter.High,
                    onChange:e=>setLevelFilter({...levelFilter, High:e.target.checked}),
                    style:{cursor:'pointer'}
                  }),
                  React.createElement('span',{style:{color:'#fecaca',fontWeight:'600'}},'üî¥ ‡∏™‡∏π‡∏á (High)')
                )
              ),
              React.createElement('div',{style:{display:'flex',gap:12,alignItems:'center'}},
                React.createElement('label',{style:{display:'flex',alignItems:'center',gap:6,cursor:'pointer'}},
                  React.createElement('input',{
                    type:'checkbox',
                    checked:levelFilter.Low,
                    onChange:e=>setLevelFilter({...levelFilter, Low:e.target.checked}),
                    style:{cursor:'pointer'}
                  }),
                  React.createElement('span',{style:{color:'#fde68a',fontWeight:'600'}},'üü° ‡∏ï‡πà‡∏≥ (Low)')
                )
              ),
              React.createElement('div',{style:{display:'flex',gap:12,alignItems:'center'}},
                React.createElement('label',{style:{display:'flex',alignItems:'center',gap:6,cursor:'pointer'}},
                  React.createElement('input',{
                    type:'checkbox',
                    checked:levelFilter.Trend,
                    onChange:e=>setLevelFilter({...levelFilter, Trend:e.target.checked}),
                    style:{cursor:'pointer'}
                  }),
                  React.createElement('span',{style:{color:'#94a3b8',fontWeight:'600'}},'‚ö™ Trend')
                )
              )
            )
          ),
          
          React.createElement('div',{className:'list'},
            filteredAlerts.length === 0 ?
              React.createElement('div',{className:'muted'},'‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô') :
              filteredAlerts.map(a=>React.createElement('div',{key:a.id,className:'row'},
                React.createElement('div',null,
                  React.createElement('div',null, a.msg),
                  React.createElement('div',{className:'muted'}, a.ts + ' ‚Ä¢ Batch ' + a.batch + ' ‚Ä¢ Metric ' + a.metric)
                ),
                React.createElement(Tag,{tone: a.type==='High'?'danger':(a.type==='Low'?'warn':'')}, a.type)
              ))
          ),
          
          React.createElement('div',{className:'nav'},
            React.createElement('button',{className:'btn',onClick:()=>go('dashboard')},'‡∏Å‡∏•‡∏±‡∏ö Dashboard')
          )
        )
      }

      function Reports({go}){
        // Mock data
        const [dateFrom, setDateFrom] = React.useState('2025-09-01');
        const [dateTo, setDateTo] = React.useState('2025-09-07');
        const [batch, setBatch] = React.useState('all');
        const [exporting, setExporting] = React.useState(false);
        const [downloadUrl, setDownloadUrl] = React.useState(null);
        const [search, setSearch] = React.useState('');
        const [stageFilter, setStageFilter] = React.useState('all');
        const stages = ['all', 'seedling', 'growing', 'mature'];
        const stageLabels = {all: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', seedling: '‡∏ï‡πâ‡∏ô‡∏Å‡∏•‡πâ‡∏≤', growing: '‡πÇ‡∏ï‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà', mature: '‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß'};
        // Historical search state: which metric to inspect across batches
        const [histMetric, setHistMetric] = React.useState('temp'); // 'height' | 'temp' | 'ph'
        // compute per-batch historical stats for the selected metric + date range
        function computeHistoricalStats(metricKey){
          const matching = batches.filter(b =>
            (stageFilter === 'all' || b.stage === stageFilter) &&
            (b.id.toLowerCase().includes(search.toLowerCase()) || b.species.toLowerCase().includes(search.toLowerCase()))
          );
          const out = matching.map(b => {
            const m = metrics[b.id] || {};
            const arr = getValuesInRange(m[metricKey] || [], dateFrom, dateTo);
            const avg = arr.length ? Math.round((arr.reduce((a,b)=>a+b,0)/arr.length)*10)/10 : '-';
            const min = arr.length ? Math.min(...arr) : '-';
            const max = arr.length ? Math.max(...arr) : '-';
            return { batchId: b.id, species: b.species, count: arr.length, avg, min, max, values: arr };
          });
          return out;
        }

        // batch options respect the search + stage filter (keep 'all')
        const batchOptions = [{id:'all', name:'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'}].concat(
          batches
            .filter(b =>
              (stageFilter === 'all' || b.stage === stageFilter) &&
              (b.id.toLowerCase().includes(search.toLowerCase()) || b.species.toLowerCase().includes(search.toLowerCase()))
            )
            .map(b=>({id:b.id, name:b.id+' - '+b.species}))
        );

        // Filtered data (mock logic)
        const filteredAlerts = alerts.filter(a=>(batch==='all'||a.batch===batch));
        const filteredMetrics = batch==='all'?metrics['A-01']:metrics[batch]||metrics['A-01'];
        const [dataMsg, setDataMsg] = React.useState('');
        const [dataVersion, setDataVersion] = React.useState(0); // bump to re-render after loading

        function validateData(obj){
          if(!obj) return false;
          if(obj.batches && !Array.isArray(obj.batches)) return false;
          if(obj.metrics && typeof obj.metrics !== 'object') return false;
          if(obj.alerts && !Array.isArray(obj.alerts)) return false;
          return true;
        }

        function handleFileUpload(file){
          const reader = new FileReader();
          reader.onload = e => {
            try{
              const parsed = JSON.parse(e.target.result);
              if(!validateData(parsed)){
                setDataMsg('‡πÑ‡∏ü‡∏•‡πå JSON ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ keys: batches[], metrics{}, alerts[] (optional)');
                return;
              }
              if(parsed.batches) batches = parsed.batches;
              if(parsed.metrics) metrics = parsed.metrics;
              if(parsed.alerts) alerts = parsed.alerts;
              setDataMsg('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
              setDataVersion(v=>v+1);
            }catch(err){
              setDataMsg('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: ' + err.message);
            }
          };
          reader.readAsText(file);
        }

        function onFileInputChange(e){
          const f = e.target.files && e.target.files[0];
          if(f) handleFileUpload(f);
        }

        // ---- helpers to map series indices to dates (assume last sample == today) ----
        const today = new Date();
        const pad = n => n.toString().padStart(2,'0');
        const fmt = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;

        function buildBaseDatesForSeries(len){
          const arr = [];
          for(let i=0;i<len;i++){
            const d = new Date();
            d.setDate(today.getDate() - (len-1 - i));
            arr.push(fmt(d));
          }
          return arr;
        }

        function getValuesInRange(valuesArray, dateFromStr, dateToStr){
          if(!valuesArray || valuesArray.length===0) return [];
          const base = buildBaseDatesForSeries(valuesArray.length);
          const fromObj = new Date(dateFromStr + 'T00:00:00');
          const toObj = new Date(dateToStr + 'T23:59:59');
          const out = [];
          base.forEach((ds,i)=>{
            const dd = new Date(ds + 'T12:00:00');
            if(dd >= fromObj && dd <= toObj){
              if(typeof valuesArray[i] !== 'undefined') out.push(valuesArray[i]);
            }
          });
          return out;
        }

        // ---- compute aggregated values (single batch or across batches) ----
        const allHeights = [];
        const allTemps = [];
        const allPHs = [];

        if(batch === 'all'){
          // aggregate across all batches that match the current search+stage filters
          const matching = batches.filter(b =>
            (stageFilter === 'all' || b.stage === stageFilter) &&
            (b.id.toLowerCase().includes(search.toLowerCase()) || b.species.toLowerCase().includes(search.toLowerCase()))
          );
          matching.forEach(b => {
            const m = metrics[b.id];
            if(!m) return;
            const hs = getValuesInRange(m.height, dateFrom, dateTo);
            const ts = getValuesInRange(m.temp, dateFrom, dateTo);
            const ps = getValuesInRange(m.ph, dateFrom, dateTo);
            allHeights.push(...hs);
            allTemps.push(...ts);
            allPHs.push(...ps);
          });
        } else {
          const m = metrics[batch] || {height:[], temp:[], ph:[]};
          allHeights.push(...getValuesInRange(m.height, dateFrom, dateTo));
          allTemps.push(...getValuesInRange(m.temp, dateFrom, dateTo));
          allPHs.push(...getValuesInRange(m.ph, dateFrom, dateTo));
        }

        const avg = arr => arr.length ? Math.round((arr.reduce((a,b)=>a+b,0)/arr.length)*10)/10 : '-';
        const avgHeight = avg(allHeights);
        const avgTemp = avg(allTemps);
        const avgPH = allPHs.length ? Math.round((allPHs.reduce((a,b)=>a+b,0)/allPHs.length)*10)/10 : '-';

        // Export PDF (mock)
        function exportPDF(){
          setExporting(true);
          // create a small mock PDF blob and trigger download immediately
          setTimeout(()=>{
            try{
              const content = `Weekly Report\n‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${dateFrom} ‡∏ñ‡∏∂‡∏á ${dateTo}\nBatch: ${batch}\n\nAvg Height: ${avgHeight} cm\nAvg Temp: ${avgTemp} ¬∞C\nAvg pH: ${avgPH}`;
              // simple PDF-like blob (for prototype). For a real PDF, integrate a library (jsPDF)
              const blob = new Blob([content], {type:'application/pdf'});
              const url = URL.createObjectURL(blob);
              // programmatically download
              const a = document.createElement('a');
              a.href = url;
              a.download = `WeeklyReport_${dateFrom}_${dateTo}.pdf`;
              document.body.appendChild(a);
              a.click();
              a.remove();
              URL.revokeObjectURL(url);
              setDownloadUrl(null);
            }catch(err){
              console.error('exportPDF error', err);
            }finally{
              setExporting(false);
            }
          }, 800);
        }
        // Progress mock
        const resourceUsed = 1.2, resourceTarget = 1.0;
        return React.createElement('div',{className:'app'},
          React.createElement('div',{className:'title'},'Weekly Report'),
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{
              style:{
                display:'flex',
                gap:18,
                flexWrap:'wrap',
                alignItems:'flex-end',
                justifyContent:'flex-start'
              }
            },
              React.createElement('div', {style:{minWidth:210}},
                React.createElement('label', {className:'muted'}, '‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'),
                React.createElement('div', {className:'flex', style:{gap:8}},
                  React.createElement('input', {type:'date', value:dateFrom, onChange:e=>setDateFrom(e.target.value)}),
                  React.createElement('span', {className:'muted'}, '‡∏ñ‡∏∂‡∏á'),
                  React.createElement('input', {type:'date', value:dateTo, onChange:e=>setDateTo(e.target.value)})
                )
              ),
              React.createElement('div', {style:{minWidth:170}},
                React.createElement('label', {className:'muted'}, '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Batch'),
                React.createElement('select', {value:batch, onChange:e=>setBatch(e.target.value), style:{width:'100%',marginTop:0}},
                  batchOptions.map(opt=>React.createElement('option',{key:opt.id, value:opt.id},opt.name))
                )
              ),
              React.createElement('div', {style:{display:'flex',alignItems:'flex-end',gap:10}},
                React.createElement('button', {
                  className:'btn accent', 
                  onClick:exportPDF, 
                  disabled:exporting,
                  style:{
                    minWidth:'140px',
                    boxShadow:'0 2px 12px 0 rgba(34,197,94,0.18)',
                    display:'flex',alignItems:'center',justifyContent:'center',gap:'8px',
                    fontSize:'17px',
                    position:'relative',
                    opacity:exporting?0.7:1,
                    cursor:exporting?'not-allowed':'pointer',
                  }
                },
                  exporting ?
                    React.createElement(React.Fragment,null,
                      React.createElement('span', {className:'spinner', style:{width:'18px',height:'18px',border:'3px solid #fff',borderTop:'3px solid #60a5fa',borderRadius:'50%',display:'inline-block',animation:'spin 1s linear infinite',verticalAlign:'middle'}}),
                      ' ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...'
                    ) :
                    React.createElement(React.Fragment,null,
                      React.createElement('span', {style:{fontWeight:700,fontSize:'20px',verticalAlign:'middle'}}, '\u21E9'),
                      ' Export PDF'
                    )
                ),
                downloadUrl && React.createElement('a', {
                  href:downloadUrl, download:`WeeklyReport_${dateFrom}_${dateTo}.pdf`,
                  className:'btn', style:{background:'#334155', color:'#fff', fontWeight:700, fontSize:'16px'},
                  children:[
                    React.createElement('span',{key:'icon',style:{fontWeight:700,fontSize:'18px',marginRight:6}},'\u2B07'),
                    '‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF'
                  ]
                })
              )
            )
          ),
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{className:'sub'},'Executive Summary'),
            React.createElement('div',null,'‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå: ‡∏ó‡∏∏‡∏Å batch ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á')
          ),
          React.createElement('div',{className:'grid kpi'},
            React.createElement(KPI,{label:'Avg Height (cm)', value: avgHeight}),
            React.createElement(KPI,{label:'Avg Temp (¬∞C)', value: avgTemp}),
            React.createElement(KPI,{label:'Avg pH', value: avgPH})
          ),
          // Historical Search card: query metric values across matching batches in selected date range
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{className:'sub'},'Historical Search ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á'),
            React.createElement('div',{style:{display:'flex',gap:12,flexWrap:'wrap',alignItems:'flex-end',marginTop:8}},
              React.createElement('div',{style:{minWidth:160}},
                React.createElement('label',{className:'muted'},'Metric'),
                React.createElement('select',{value:histMetric,onChange:e=>setHistMetric(e.target.value), style:{marginTop:6}},
                  React.createElement('option',{value:'height'},'Height (cm)'),
                  React.createElement('option',{value:'temp'},'Temperature (¬∞C)'),
                  React.createElement('option',{value:'ph'},'pH')
                )
              ),
              React.createElement('div',{style:{minWidth:210}},
                React.createElement('label',{className:'muted'}, '‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'),
                React.createElement('div',{className:'flex', style:{gap:8}},
                  React.createElement('input',{type:'date', value:dateFrom, onChange:e=>setDateFrom(e.target.value)}),
                  React.createElement('span',{className:'muted'},'‡∏ñ‡∏∂‡∏á'),
                  React.createElement('input',{type:'date', value:dateTo, onChange:e=>setDateTo(e.target.value)})
                )
              ),
              React.createElement('div',{style:{display:'flex',alignItems:'center',gap:8}},
                React.createElement('button',{className:'btn', onClick:()=>{/* no-op; results recompute automatically */}},'‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤')
              )
            ),
            React.createElement('div',{style:{marginTop:12}},
              (function(){
                const histResults = computeHistoricalStats(histMetric);
                if(!histResults || histResults.length===0) return React.createElement('div',{className:'muted'},'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
                return React.createElement('table',{style:{width:'100%',borderCollapse:'collapse',fontSize:'14px'}},
                  React.createElement('thead',null,
                    React.createElement('tr',null,
                      React.createElement('th',{style:{textAlign:'left',padding:'6px',color:'var(--muted)'}},'Batch'),
                      React.createElement('th',{style:{textAlign:'left',padding:'6px',color:'var(--muted)'}},'Species'),
                      React.createElement('th',{style:{textAlign:'right',padding:'6px',color:'var(--muted)'}},'Count'),
                      React.createElement('th',{style:{textAlign:'right',padding:'6px',color:'var(--muted)'}},'Avg'),
                      React.createElement('th',{style:{textAlign:'right',padding:'6px',color:'var(--muted)'}},'Min'),
                      React.createElement('th',{style:{textAlign:'right',padding:'6px',color:'var(--muted)'}},'Max')
                    )
                  ),
                  React.createElement('tbody',null,
                    histResults.map(r=>React.createElement('tr',{key:r.batchId},
                      React.createElement('td',{style:{padding:'6px'}},r.batchId),
                      React.createElement('td',{style:{padding:'6px'}},r.species),
                      React.createElement('td',{style:{padding:'6px',textAlign:'right'}},r.count),
                      React.createElement('td',{style:{padding:'6px',textAlign:'right'}},r.avg),
                      React.createElement('td',{style:{padding:'6px',textAlign:'right'}},r.min),
                      React.createElement('td',{style:{padding:'6px',textAlign:'right'}},r.max)
                    ))
                  )
                );
              })()
            )
          ),
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{className:'sub'},'Batch Highlights'),
            React.createElement('ul',null,
              batches.filter(b=>batch==='all'||b.id===batch).map(b=>
                React.createElement('li',{key:b.id},
                  b.id+': '+b.species+' ('+b.stage+') ‚Äî ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡∏π‡∏Å '+b.start+', ‡∏£‡∏π‡∏õ '+b.images+' ‡∏†‡∏≤‡∏û'
                )
              )
            )
          ),
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{className:'sub'},'Trends & Anomalies'),
            React.createElement('div',{style:{marginBottom:8}},'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡πâ‡∏ô (cm)'),
            React.createElement(ModernChart,{series: filteredMetrics.height, color:'#60a5fa'}),
            React.createElement('div',{style:{marginTop:12}},'pH'),
            React.createElement(ModernChart,{series: filteredMetrics.ph, color:'#22c55e'})
          ),
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{className:'sub'},'Alerts & Resolutions'),
            React.createElement('table',{style:{width:'100%',borderCollapse:'collapse',fontSize:'15px'}},
              React.createElement('thead',null,
                React.createElement('tr',null,
                  React.createElement('th',{style:{textAlign:'left',padding:'6px',color:'var(--muted)'}},'‡πÄ‡∏ß‡∏•‡∏≤'),
                  React.createElement('th',{style:{textAlign:'left',padding:'6px',color:'var(--muted)'}},'Batch'),
                  React.createElement('th',{style:{textAlign:'left',padding:'6px',color:'var(--muted)'}},'Alert'),
                  React.createElement('th',{style:{textAlign:'left',padding:'6px',color:'var(--muted)'}},'Action')
                )
              ),
              React.createElement('tbody',null,
                filteredAlerts.length===0 ?
                  React.createElement('tr',null,
                    React.createElement('td',{colSpan:4,style:{color:'var(--muted)',padding:'8px'}},'‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•')
                  ) :
                  filteredAlerts.map(a=>React.createElement('tr',{key:a.id},
                    React.createElement('td',{style:{padding:'6px'}},a.ts),
                    React.createElement('td',{style:{padding:'6px'}},a.batch),
                    React.createElement('td',{style:{padding:'6px'}},a.msg),
                    React.createElement('td',{style:{padding:'6px'}},a.action)
                  ))
              )
            )
          ),
          React.createElement('div',{className:'card', style:{marginBottom:18}},
            React.createElement('div',{className:'sub'},'Resource Usage vs Target'),
            React.createElement('div',{style:{marginBottom:8}},`Water Usage: ${resourceUsed} L/kg (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ${resourceTarget} L/kg)`),
            React.createElement('div',{
              style:{background:'#1e293b',borderRadius:'10px',height:'22px',width:'100%',overflow:'hidden',boxShadow:'0 1px 4px 0 rgba(34,197,94,0.07)',marginBottom:4}
            },
              React.createElement('div',{
                style:{height:'100%',width:Math.min(100,resourceUsed/resourceTarget*100)+'%',background:'var(--accent)',transition:'width .4s',borderRadius:'10px'}
              })
            ),
            React.createElement('div',{
              style:{fontSize:'13px',color: resourceUsed>resourceTarget?'#ef4444':'var(--muted)'}
            }, resourceUsed>resourceTarget?'‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢':'‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢')
          ),
          React.createElement('div',{className:'nav'},
            React.createElement('button',{className:'btn',onClick:()=>go('dashboard')},'‡∏Å‡∏•‡∏±‡∏ö Dashboard')
          )
        )
      }

      function Settings({go}){
        return React.createElement('div',{className:'app'},
          React.createElement('div',{className:'title'},'Settings (Threshold ‚Äî Mock)'),
          React.createElement('div',{className:'grid', style:{gridTemplateColumns:'1fr 1fr', gap:'12px'}},
            React.createElement('div',{className:'field'},
              React.createElement('label',null,'Temp (¬∞C) ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î'),
              React.createElement('input',{placeholder:'18'})
            ),
            React.createElement('div',{className:'field'},
              React.createElement('label',null,'Temp (¬∞C) ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î'),
              React.createElement('input',{placeholder:'26'})
            ),
            React.createElement('div',{className:'field'},
              React.createElement('label',null,'pH ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î'),
              React.createElement('input',{placeholder:'5.8'})
            ),
            React.createElement('div',{className:'field'},
              React.createElement('label',null,'pH ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î'),
              React.createElement('input',{placeholder:'6.5'})
            ),
          ),
          React.createElement('div',{className:'nav'},
            React.createElement('button',{className:'btn',onClick:()=>go('dashboard')},'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (mock) ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö')
          )
        )
      }

      function App(){
        const [user,setUser]=useState(null);
        const [route,setRoute]=useState('login');
        const [detailId,setDetailId]=useState(null);

        // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (scroll) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ login
        useEffect(()=>{
          const isLogin = (!user || route==='login');
          if(isLogin){
            // ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™
            document.body.style.overflow = 'hidden';
          } else {
            document.body.style.overflow = '';
          }
          // cleanup: ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠ component ‡∏ñ‡∏π‡∏Å unmount ‡∏´‡∏£‡∏∑‡∏≠ dependencies ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
          return ()=>{ document.body.style.overflow = ''; };
        },[user,route]);

        function go(name, arg){
          setRoute(name);
          if(name==='detail') setDetailId(arg);
        }

        function logout(){
          // clear user and go to login
          setUser(null);
          setRoute('login');
          setDetailId(null);
          // ensure body scroll is enabled and scroll to top
          document.body.style.overflow = '';
          window.scrollTo(0,0);
        }

        if(!user || route==='login') return React.createElement(Login,{onLogin:(u)=>{setUser(u); setRoute('dashboard')}});

  if(route==='dashboard') return React.createElement(Dashboard,{go, onLogout:logout});
  if(route==='batches') return React.createElement(Batches,{go, onLogout:logout});
  if(route==='detail') return React.createElement(BatchDetail,{id:detailId, go, onLogout:logout});
  if(route==='alerts') return React.createElement(Alerts,{go, onLogout:logout});
  if(route==='reports') return React.createElement(Reports,{go, onLogout:logout});
  if(route==='settings') return React.createElement(Settings,{go, onLogout:logout});
        return React.createElement('div',null,'Not found');
      }

      ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
  </body>
</html>
